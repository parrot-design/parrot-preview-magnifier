!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("@parrotjs/classnames"),require("@parrotjs/dom-utils"),require("@parrotjs/react-hooks"),require("@parrotjs/react-icon"),require("@parrotjs/react-icon/dist/index.css"),require("@parrotjs/react-popper")):"function"==typeof define&&define.amd?define(["react","@parrotjs/classnames","@parrotjs/dom-utils","@parrotjs/react-hooks","@parrotjs/react-icon","@parrotjs/react-icon/dist/index.css","@parrotjs/react-popper"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).ParrotRcPreviewMagnifier=t(e.React,e.ParrotClassname,e.ParrotDomUtils,e.ParrotRcHooks,e.ParrotRcIcon,null,e.ParrotRcPopper)}(this,(function(e,t,r,i,o,a,n){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=s(e),c=s(t),f=s(n);const u=l.default.forwardRef(((t,r)=>{const{parentSize:i=0,shrinkProportion:o,prefixCls:a="parrot",componentName:n="selected-box",visible:s,position:f,sizeCallback:u=(()=>{})}=t,p=a+"-"+n,d=i*o,m=Object.assign({width:d,height:d},f);return e.useEffect((()=>{d>0&&u(d)}),[d,u]),l.default.createElement("span",{className:c.default(p,{[`${p}-hidden`]:!s}),style:m,ref:r})})),p=l.default.forwardRef(((e,t)=>{const{prefixCls:r="parrot",componentName:i="search-icon",visible:a}=e,n=r+"-"+i;return l.default.createElement("span",{className:c.default(n,{[`${n}-hidden`]:!a})},l.default.createElement(o.Search,{size:"default"}))}));let d={left:0,top:0};const m=l.default.forwardRef(((e,t)=>{const{prefixCls:r="parrot",componentName:i="preview-box",target:o,size:a,offsetLeft:n,imgUrl:s,shrinkProportion:u,previewBoxSize:p,position:d,visible:m}=e,h=r+"-"+i,g=1/u*p,b=g*a,v={width:a*p,height:a*p},w={width:b,height:b,left:-d.left*g,top:-d.top*g};return l.default.createElement(f.default,{target:o,visible:m,placement:"right",popperOptions:{modifiers:[{name:"offset",options:{offset:[0,n]}}]}},l.default.createElement("div",{className:c.default(h),ref:t,style:v},s?l.default.createElement("img",{src:s,style:w}):null))})),h={width:0,height:0,left:0,top:0,bottom:0,right:0};return l.default.forwardRef(((t,o)=>{var a;const{prefixCls:n="parrot",componentName:s="preview-magnifier",children:f,offsetLeft:g=10,shrinkProportion:b=.5,previewBoxSize:v=1}=t,w=n+"-"+s,j=e.useRef(null),[k,C]=e.useState(0),R=e.useRef(null),x=e.useRef(null),E=e.useRef(null),[P,S]=e.useState(0),[z,N]=e.useState(!1),y=e.useCallback((e=>{S(e)}),[]);e.useEffect((()=>{const{width:e,height:t}=r.getBoundingClientRect(R.current);C(Math.max(e,t))}),[]);const{position:q,start:B,move:X,reset:Y}=function(t,r){const{left:i,right:o,top:a,bottom:n,width:s,height:l}=t,{width:c}=r,f=c/2,[u,p]=e.useState(0),[m,h]=e.useState(0),[g,b]=e.useState(d),v=()=>{p(0),h(0),b(d)},w=e.useCallback((e=>{let t,r;e.clientX-i<f?r=0:o-e.clientX<f?r=s-c:(o-e.clientX>f||e.clientX-i>f)&&(r=e.clientX-i-f),e.clientY-a<f?t=0:n-e.clientY<f?t=l-c:(n-e.clientY>f||e.clientY-a>f)&&(t=e.clientY-a-f),b({top:t,left:r})}),[i,o,a,n,s,l,c]);return{start:e=>{v(),p(e.clientX),h(e.clientY),w(e)},move:e.useCallback((e=>{w(e)}),[w]),reset:v,startX:u,startY:m,position:g}}(R.current?r.getBoundingClientRect(R.current):h,E.current?Object.assign(Object.assign({},r.getBoundingClientRect(E.current)),{width:P}):h),M=e.useCallback((e=>{N(!0),B(e)}),[B]),L=e.useCallback((e=>{N(!1),Y()}),[Y]),O=e.useCallback((e=>{X(e)}),[X]),U=i.useForkRef(o,j);return l.default.createElement("div",{className:c.default(w),onMouseMove:O,ref:U},l.default.createElement("div",{className:`${w}-action`,onMouseEnter:M,onMouseLeave:L},l.default.cloneElement(f,{ref:R}),l.default.createElement(u,{visible:z,parentSize:k,prefixCls:n,position:q,shrinkProportion:b,sizeCallback:y,ref:E})),l.default.createElement(p,{visible:!z}),l.default.createElement(m,{ref:x,target:j.current,offsetLeft:g,visible:z,size:k,selectBoxSize:P,previewBoxSize:v,shrinkProportion:b,imgUrl:null===(a=null==R?void 0:R.current)||void 0===a?void 0:a.src,position:q}))}))}));
