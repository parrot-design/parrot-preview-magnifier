!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("@parrotjs/classnames"),require("@parrotjs/dom-utils"),require("@parrotjs/react-hooks"),require("@parrotjs/react-icon"),require("@parrotjs/react-icon/dist/index.css"),require("@parrotjs/react-popper")):"function"==typeof define&&define.amd?define(["react","@parrotjs/classnames","@parrotjs/dom-utils","@parrotjs/react-hooks","@parrotjs/react-icon","@parrotjs/react-icon/dist/index.css","@parrotjs/react-popper"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).ParrotRcPreviewMagnifier=t(e.React,e.ParrotClassname,e.ParrotDomUtils,e.ParrotRcHooks,e.ParrotRcIcon,null,e.ParrotRcPopper)}(this,(function(e,t,r,i,o,a,s){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=n(e),c=n(t),u=n(s);const f=l.default.forwardRef(((t,r)=>{const{parentSize:i=0,shrinkProportion:o,prefixCls:a="parrot",componentName:s="selected-box",visible:n,position:u,sizeCallback:f=(()=>{})}=t,p=a+"-"+s,d=i*o,m=Object.assign({width:d,height:d},u);return e.useEffect((()=>{d>0&&f(d)}),[d,f]),l.default.createElement("span",{className:c.default(p,{[`${p}-hidden`]:!n}),style:m,ref:r})})),p=l.default.forwardRef(((e,t)=>{const{prefixCls:r="parrot",componentName:i="search-icon",visible:a}=e,s=r+"-"+i;return l.default.createElement("span",{className:c.default(s,{[`${s}-hidden`]:!a})},l.default.createElement(o.Search,{size:"default"}))}));let d={left:0,top:0};const m=l.default.forwardRef(((e,t)=>{const{prefixCls:r="parrot",componentName:i="preview-box",target:o,size:a,offsetLeft:s,imgUrl:n,shrinkProportion:f,previewBoxSize:p,position:d,visible:m}=e,h=r+"-"+i,g=1/f*p,b=g*a,v={width:a*p,height:a*p},w={width:b,height:b,left:-d.left*g,top:-d.top*g};return l.default.createElement(u.default,{target:o,visible:m,placement:"right",popperOptions:{modifiers:[{name:"offset",options:{offset:[0,s]}}]}},l.default.createElement("div",{className:c.default(h),ref:t,style:v},n?l.default.createElement("img",{src:n,style:w}):null))})),h={width:0,height:0,left:0,top:0,bottom:0,right:0};return l.default.forwardRef(((t,o)=>{const{prefixCls:a="parrot",componentName:s="preview-magnifier",children:n,offsetLeft:u=10,shrinkProportion:g=.5,previewBoxSize:b=1}=t,v=a+"-"+s,w=e.useRef(null),[j,k]=e.useState(0),[C,R]=e.useState(),x=e.useRef(null),E=e.useRef(null),S=e.useRef(null),[P,z]=e.useState(0),[N,y]=e.useState(!1),q=e.useCallback((e=>{z(e)}),[]);e.useEffect((()=>{var e;const{width:t,height:i}=r.getBoundingClientRect(x.current);R(null===(e=null==x?void 0:x.current)||void 0===e?void 0:e.src),k(Math.max(t,i))}),[]);const{position:B,start:X,move:Y,reset:M}=function(t,r){const{left:i,right:o,top:a,bottom:s,width:n,height:l}=t,{width:c}=r,u=c/2,[f,p]=e.useState(0),[m,h]=e.useState(0),[g,b]=e.useState(d),v=()=>{p(0),h(0),b(d)},w=e.useCallback((e=>{let t,r;e.clientX-i<u?r=0:o-e.clientX<u?r=n-c:(o-e.clientX>u||e.clientX-i>u)&&(r=e.clientX-i-u),e.clientY-a<u?t=0:s-e.clientY<u?t=l-c:(s-e.clientY>u||e.clientY-a>u)&&(t=e.clientY-a-u),b({top:t,left:r})}),[i,o,a,s,n,l,c]);return{start:e=>{v(),p(e.clientX),h(e.clientY),w(e)},move:e.useCallback((e=>{w(e)}),[w]),reset:v,startX:f,startY:m,position:g}}(x.current?r.getBoundingClientRect(x.current):h,S.current?Object.assign(Object.assign({},r.getBoundingClientRect(S.current)),{width:P}):h),L=e.useCallback((e=>{y(!0),X(e)}),[X]),O=e.useCallback((e=>{y(!1),M()}),[M]),U=e.useCallback((e=>{Y(e)}),[Y]),$=i.useForkRef(o,w);return l.default.createElement("div",{className:c.default(v),onMouseMove:U,ref:$},l.default.createElement("div",{className:`${v}-action`,onMouseEnter:L,onMouseLeave:O},l.default.cloneElement(n,{ref:x}),l.default.createElement(f,{visible:N,parentSize:j,prefixCls:a,position:B,shrinkProportion:g,sizeCallback:q,ref:S})),l.default.createElement(p,{visible:!N}),l.default.createElement(m,{ref:E,target:w.current,offsetLeft:u,visible:N,size:j,selectBoxSize:P,previewBoxSize:b,shrinkProportion:g,imgUrl:C,position:B}))}))}));
